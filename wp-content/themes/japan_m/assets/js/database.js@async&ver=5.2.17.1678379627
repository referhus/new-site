function saveComparisonToLocalDatabase(comparisonToolData) {
  $.ajax({
    type: "POST",
    url: result.ajaxurl,
    data: {
      action: "save_comparison_results",
      data: comparisonToolData,
    },
    success: function (response) {
      const uniqueId = response.data.ID;

      console.log(uniqueId);

      if (response.success) {
        setCookie(uniqueId);
      } else {
        showError();
      }
    },
  });
}

function setCookie(id) {
  const maxAge = 36500;

  Cookies.set("userId", id, { expires: maxAge });
  console.log("cookie set");
}
// function fetchUserData(id) {
//   $.ajax({
//     url: result.ajaxurl,
//     data: {
//       action: "get_comparison_tool_record",
//       data: id,
//     },
//     success: function (response) {
//       const user = response.data[0];

//       populateFormData(user);
//     },
//   });
// }

function fetchUserData(id) {
  //check survey results
  $.ajax({
    url: result.ajaxurl,
    data: {
      action: "get_comparison_tool_record",
      data: id,
    },
    success: function (response) {
      const user = response.data.length > 0;

      if (user) {
        const userData = response.data[0];
        populateFormData(userData);
      } else {
        //check download records
        $.ajax({
          url: result.ajaxurl,
          data: {
            action: "get_download_result_record",
            data: id,
          },
          success: function (response) {
            const user = response.data.length > 0;

            if (user) {
              const userData = response.data[0];
              populateFormData(userData);
            }
          },
        });
      }
    },
  });
}

function populateFormData(user) {
  // const user = await fetchUserData(id);
  const nameFields = $(".ct-field-name");
  const emailFields = $(".ct-field-email");
  const jobTitleFields = $(".ct-field-job-title");
  const companyNameFields = $(".ct-field-company-name");

  console.log(user);
  console.log("auto fill");

  if (user) {
    autoFill(nameFields, user.name);
    autoFill(emailFields, user.email);
    autoFill(jobTitleFields, user.job_title);
    autoFill(companyNameFields, user.company_name);
  }

  function autoFill(fields, value) {
    // field.val(value);
    $(fields).each(function () {
      $(this).val(value);
    });
  }
}

function showError() {
  console.log("error saving");
  window.alert("Data was not saved. Please contact the administrator.");
}
